@page
@model NetConf.Xncf.Admin.Areas.Admin.Pages.Products.IndexModel
@{
    ViewData["Title"] = "商品列表页面";
    Layout = "_Layout_Vue";
}

@section Style{
    <link href="~/css/Admin/Products/Products.css" rel="stylesheet" />
}

@section HeaderContent{
    <style>
        .el-dialog .el-form-item .el-input,
        .el-dialog .el-form-item .el-textarea {
            width: 30rem;
        }

        .el-form-item__content {
            width: 30rem;
        }

        .filter-condition {
            margin-bottom: 1rem;
        }

        .hidden {
            display: none;
        }

        .col-thumb img {
            width: 4rem;
            height: 4rem;
        }
    </style>
}

@section breadcrumbs {
    <el-breadcrumb-item>扩展模块</el-breadcrumb-item>
    <el-breadcrumb-item>电子商务</el-breadcrumb-item>
    <el-breadcrumb-item>商品列表</el-breadcrumb-item>
}

<div>
    <div class="admin-role">
        <el-row class="filter-condition" :gutter="18">
            <el-col :span="4"><el-input v-model="keyword" placeholder="请输入关键字"></el-input></el-col>
            <el-col :span="6">
                <el-button type="primary" @@click="handleSearch()">查询</el-button>
                <el-button type="primary" @@click="resetCondition()">重置</el-button>
            </el-col>
        </el-row>
        <div class="filter-container">
            <el-button class="filter-item" size="mini" type="primary" icon="el-icon-plus" @@click="handleEdit('','','add')">增加商品</el-button>
        </div>
        <el-table :data="tableData"
                  style="width: 100%;margin-bottom: 20px;"
                  row-key="id"
                  border
                  ref="multipleTable"
                  @@selection-change="handleSelectionChange">
            <el-table-column label="序号" width="65">
                <template scope="scope">
                    <el-radio :label="scope.$index" v-model="radio" @@change.native="getCurrentRow(scope.row)"></el-radio>
                </template>
            </el-table-column>

            @*<el-table-column prop="categoryId" align="left" label="分类Id"></el-table-column>*@
            <el-table-column prop="categoryName" align="left" label="分类名称"></el-table-column>
            <el-table-column prop="name" align="left" label="商品名称"></el-table-column>
            <el-table-column prop="cover" class-name="col-thumb" align="center" label="封面图">
                <template slot-scope="scope">
                    <a :href="scope.row.cover ? scope.row.cover : 'https://mltest2020.oss-cn-beijing.aliyuncs.com/lelinggusu/work_1.jpg'" target="_blank">
                        <img :src="scope.row.cover ? scope.row.cover : 'https://mltest2020.oss-cn-beijing.aliyuncs.com/lelinggusu/work_1.jpg'">
                    </a>
                </template>
            </el-table-column>
            <el-table-column prop="video" align="left" label="视频简介"></el-table-column>
            <el-table-column prop="content" align="left" label="内容"></el-table-column>
            <el-table-column align="center"
                             label="添加时间">
                <template slot-scope="scope">
                    {{formaTableTime(scope.row.addTime)}}
                </template>
            </el-table-column>
            <el-table-column label="操作" align="center" fixed="right" width="150">
                <template slot-scope="scope">
                    <el-button size="mini"
                               type="primary"
                               @@click="handleEdit(scope.$index, scope.row,'edit')">编辑</el-button>
                    <el-popconfirm placement="top" title="确认删除此作品吗？" @@on-confirm="handleDelete(scope.$index, scope.row)">
                        <el-button size="mini" type="danger" slot="reference">删除</el-button>
                    </el-popconfirm>
                </template>
            </el-table-column>
        </el-table>

        <pagination :total="paginationQuery.total"
                    :page.sync="listQuery.pageIndex"
                    :limit.sync="listQuery.pageSize"
                    @@pagination="getList"></pagination>
        <!--编辑、新增-->
        <el-dialog :title="dialog.title"
                   :visible.sync="dialog.visible"
                   :close-on-click-modal="false"
                   width="700px">
            <el-form ref="dataForm"
                     :rules="dialog.rules"
                     :model="dialog.data"
                     :disabled="dialog.disabled"
                     label-position="left"
                     label-width="100px"
                     style="max-width: 200px; margin-left:50px;">
                <el-form-item label="分类Id">
                    <el-cascader v-model="selectCategory"
                                 :options="categoryData"
                                 @@change="selectType"
                                 clearable
                                 :props="{label:'name',value:'id',emitPath:true}">
                    </el-cascader>
                </el-form-item>

                <el-form-item label="商品名称" prop="name">
                    <el-input v-model="dialog.data.name" clearable placeholder="请输入商品名称" />
                </el-form-item>

                <el-form-item label="封面图">
                    <el-upload action="@Model.UpFileUrl"
                               list-type="picture-card"
                               show-file-list="true"
                               accept="image/png, image/jpeg"
                               :on-success="uploadSuccess"
                               :on-error="uploadError"
                               :on-preview="handlePictureCardPreview"
                               :on-remove="handleRemove">
                        <i class="el-icon-plus"></i>
                        <div class="el-upload__tip" slot="tip">不能超过100MB</div>
                    </el-upload>
                    <img width="100%" :src="dialogImageUrl" alt="">
                    <el-input class="hidden" v-model="dialog.data.cover" clearable placeholder="封面图" />
                </el-form-item>
                <el-form-item label="视频简介" prop="video">
                    <el-input v-model="dialog.data.video" clearable placeholder="请输入视频简介" />
                </el-form-item>

                <el-form-item label="内容" prop="content">
                    <el-input v-model="dialog.data.content" clearable placeholder="请输入内容" />
                </el-form-item>
                <el-form-item label="价格" prop="price">
                    <el-input v-model="dialog.data.price" clearable placeholder="请输入价格" />
                </el-form-item>
            </el-form>
            <div slot="footer" class="dialog-footer">
                <el-button @@click="dialog.visible=false">取消</el-button>
                <el-button :loading="dialog.updateLoading" :disabled="dialog.disabled" type="primary" @@click="updateData">确认</el-button>
            </div>
        </el-dialog>
    </div>
</div>
@section scripts
{
    <script src="~/js/Basic/ml.js"></script>
    <script src="~/js/Admin/Pages/Products/products.js"></script>
}